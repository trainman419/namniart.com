<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type" />
  <title>Lake Denman - Monitoring the System with Monit</title>
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  <!-- Homepage CSS -->
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
</head>

<body id="post">
  <div id='content-wrapper'>
    <h1 id='page-title'>
      <a href="/">
        Lake Denman
      </a>
    </h1>

    <div id='content'>
      <h2>Monitoring the System with Monit</h2>
      <p>I&#8217;m on OS X and I just downloaded &#8220;Monit&#8221; via Macports:</p>
<div class='highlight'><pre><span class='nv'>$ </span>sudo port install monit
</pre>
</div>
<p>I need to be able to monitor some things on my box. Namely, File System Size, CPU, MySQL and Nginx. Fortunately, Monit can easily take care of monitoring many resources and then reporting feedback.</p>

<h2 id='setting_up_alerts'>Setting up Alerts</h2>

<p>Figuring out who needs to be informed when something is acting up is important. Monit will log any errors to a specified log file. Also, Monit allows emailing alerts. In order to enable file logging and email logging, you have to set the <code>logfile</code> and <code>alert</code> keywords in the <code>/etc/monitrc</code> file.</p>
<div class='highlight'><pre>set alert lake@lakedenman.com
set logfile /var/log/monit.log
</pre>
</div>
<p>Now, when any of the monitored services act up, Monit will let the alertee know right away! I&#8217;m itching to start add checks on system services, processes, and devices, so let&#8217;s go.</p>

<h2 id='setting_system_checks'>Setting System Checks</h2>

<h3 id='file_system_space'>File System Space</h3>

<p>The first resource I want Monit to monitor is <a href='http://mmonit.com/monit/documentation/monit.html#space_testing'>disk space</a>.</p>

<p>I added this snippet to my <code>/etc/monitrc</code> file:</p>
<div class='highlight'><pre>check device lake with path /
  if space usage &gt; 90 % then alert
</pre>
</div>
<p>The line above simply checks my root filesystem and alerts me if the space grows above 90 percent. Now that the disk usage is being monitored, I want to add a check for CPU usage.</p>

<h3 id='cpu_usage'>CPU Usage</h3>

<p>The snippet below will tell Monit to monitor the cpu usage of the system:</p>
<div class='highlight'><pre>check system lake.local
  if cpu usage (user) &gt; 70% then alert
  if cpu usage (system) &gt; 30% then alert
  if cpu usage (wait) &gt; 20% then alert
</pre>
</div>
<p>Okay, so Monit will alert me when the CPU Usage is too high. It&#8217;s time to tell Monit to take a look at MySQL.</p>

<h3 id='mysql'>MySQL</h3>
<div class='highlight'><pre>check process mysql
  with pidfile &quot;/usr/local/mysql/data/lake.local.pid&quot;
  start program = &quot;/Library/StartupItems/MySQLCOM/MySQLCOM start&quot;
  stop program = &quot;/Library/StartupItems/MySQLCOM/MySQLCOM stop&quot;
  if failed host 127.0.0.1 port 3306 then restart
  if 5 restarts within 5 cycles then timeout
</pre>
</div>
<p><a href='http://mmonit.com/monit/documentation/monit.html'>Monit Manual</a></p>
      <a href="/">&laquo; Home</a>
    </div>

    <div id= 'footer'>
      <a href="mailto:lake@lakedenman.com">Email</a> | 
      <a href="skype:call?name=lakedenman">Skype</a> | 
      <a href="http://twitter.com/ldenman">Twitter</a> |
      <a href="http://github.com/ldenman">Github</a>
    </div>
    
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
      try {
      var pageTracker = _gat._getTracker("UA-350849-5");
      pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </div>
</body>

</html>